<?xml version="1.0" encoding="UTF-8"?>
<itop_design xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.7">
  <constants>
  </constants>
  <classes>
		<class id="Certificate" _delta="define">
			<parent>cmdbAbstractObject</parent>
			<properties>
				<category>bizmodel,searchable</category>
				<abstract>false</abstract>
				<key_type>autoincrement</key_type>
				<db_table>certificate</db_table>
				<db_key_field>id</db_key_field>
				<db_final_class_field/>
				<naming>
					<format>%1$s</format>
					<attributes>
						<attribute id="name"/>
					</attributes>
				</naming>
				<display_template/>
				<icon>assets/img/certificate.svg</icon>
				<reconciliation>
					<attributes>
						<attribute id="name"/>
					</attributes>
				</reconciliation>
			</properties>
      <fields>
				<field id="name" xsi:type="AttributeString">
					<sql>name</sql>
					<default_value/>
					<is_null_allowed>false</is_null_allowed>
				</field>
				<field id="description" xsi:type="AttributeString">
					<sql>description</sql>
					<is_null_allowed>true</is_null_allowed>
				</field>
				<field id="org_id" xsi:type="AttributeExternalKey">
					<sql>org_id</sql>
					<target_class>Organization</target_class>
					<is_null_allowed>false</is_null_allowed>
					<on_target_delete>DEL_MANUAL</on_target_delete>
				</field>
				<field id="org_name" xsi:type="AttributeExternalField">
					<extkey_attcode>org_id</extkey_attcode>
					<target_attcode>name</target_attcode>
				</field>
        <field id="provider_name" xsi:type="AttributeString">
					<sql>provider_name</sql>
					<is_null_allowed>true</is_null_allowed>
				</field>
        <field id="provider_org" xsi:type="AttributeString">
					<sql>provider_org</sql>
					<is_null_allowed>true</is_null_allowed>
				</field>
        <field id="san" xsi:type="AttributeText">
					<sql>san</sql>
					<is_null_allowed>true</is_null_allowed>
				</field>
        <field id="serial_number" xsi:type="AttributeString">
					<sql>serial_number</sql>
					<is_null_allowed>true</is_null_allowed>
				</field>
        <field id="delivery_date" xsi:type="AttributeDate">
					<sql>delivery_date</sql>
					<is_null_allowed>true</is_null_allowed>
				</field>
        <field id="expiration_date" xsi:type="AttributeDate">
					<sql>expiration_date</sql>
					<is_null_allowed>true</is_null_allowed>
				</field>
        <field id="expiration_days" xsi:type="AttributeString">
          <dependencies>
            <attribute id="expiration_date"/>
          </dependencies>
					<sql>expiration_days</sql>
          <tracking_level>none</tracking_level>
					<is_null_allowed>true</is_null_allowed>
				</field>
        <field id="comment" xsi:type="AttributeText">
					<sql>comment</sql>
					<default_value/>
					<is_null_allowed>true</is_null_allowed>
				</field>
      </fields>
      <methods>
        <method id="ComputeValues">
          <comment>compute number of days until cetificate expiration</comment>
          <static>false</static>
          <access>public</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[ public function ComputeValues()
{
  parent::ComputeValues();

  $dateend = new DateTimeImmutable($this->Get('expiration_date'));
  $datenow = new DateTimeImmutable(date('Y-m-d'));
  $interval = $datenow->diff($dateend);
  // echo $interval->format("%r%a days\n");
  $this->Set('expiration_days', $interval->format('%r%a'));
}]]></code>
        </method>
      </methods>
      <presentation>
        <details>
          <items>
            <item id="name">
              <rank>10</rank>
            </item>
            <item id="org_id">
              <rank>20</rank>
            </item>
            <item id="description">
              <rank>30</rank>
            </item>
            <item id="provider_name">
              <rank>40</rank>
            </item>
            <item id="provider_org">
              <rank>45</rank>
            </item>
            <item id="serial_number">
              <rank>50</rank>
            </item>
            <item id="delivery_date">
              <rank>55</rank>
            </item>
            <item id="expiration_date">
              <rank>60</rank>
            </item>
            <item id="expiration_days">
              <rank>65</rank>
            </item>
            <item id="san">
              <rank>70</rank>
            </item>
            <item id="comment">
              <rank>80</rank>
            </item>
          </items>
        </details>
        <list>
           <items>
            <item id="name">
              <rank>10</rank>
            </item>
            <item id="org_id">
              <rank>20</rank>
            </item>
            <item id="description">
              <rank>30</rank>
            </item>
            <item id="delivery_date">
              <rank>55</rank>
            </item>
            <item id="expiration_date">
              <rank>60</rank>
            </item>
          </items>
        </list>
        <search>
           <items>
            <item id="name">
              <rank>10</rank>
            </item>
            <item id="org_id">
              <rank>20</rank>
            </item>
            <item id="description">
              <rank>30</rank>
            </item>
            <item id="delivery_date">
              <rank>55</rank>
            </item>
            <item id="expiration_date">
              <rank>60</rank>
            </item>
          </items>
        </search>
      </presentation>
    </class>
  </classes>
  <menus>
		<menu id="ConfigManagementOverview" xsi:type="DashboardMenuNode" _delta="must_exist">
			<rank>1</rank>
			<parent>ConfigManagement</parent>
			<definition>
				<layout>DashboardLayoutOneCol</layout>
				<title/>
				<cells>
					<cell id="2" _delta="must_exist"> <!-- Dashboard -> Software -->
						<rank>0</rank>
						<dashlets>
							<dashlet id="89" xsi:type="DashletBadge" _delta="define">
								<rank>1</rank>
								<class>Certificate</class>
							</dashlet>
						</dashlets>
					</cell>
				</cells>
			</definition>
		</menu>
  </menus>
  <user_rights>
    <groups>
    </groups>
    <profiles>
    </profiles>
  </user_rights>
</itop_design>
